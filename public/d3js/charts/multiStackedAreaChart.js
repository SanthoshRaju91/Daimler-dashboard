function stackedAreaChart(){

var histcatexplong = [
  {
    "key" : "OTM" ,
    "values" : [ 
	[ 1380585600000 , 1] , 
	[ 1380672000000 , 6] , 
	[ 1380758400000 , 6] , 
	[ 1380844800000 , 2] , 
	[ 1380931200000 , 0] , 
	[ 1381017600000 , 0] , 
	[ 1381104000000 , 6] , 
	[ 1381190400000 , 1] , 
	[ 1381276800000 , 1] , 
	[ 1381363200000 , 0] , 
	[ 1381449600000 , 1] , 
	[ 1381536000000 , 0] , 
	[ 1381622400000 , 1] , 
	[ 1381708800000 , 2] , 
	[ 1381795200000 , 2] , 
	[ 1381881600000 , 3] , 
	[ 1381968000000 , 3] , 
	[ 1382054400000 , 1] , 
	[ 1382140800000 , 0] , 
	[ 1382227200000 , 0] , 
	[ 1382313600000 , 2] , 
	[ 1382400000000 , 4] , 
	[ 1382486400000 , 3] , 
	[ 1382572800000 , 2] , 
	[ 1382659200000 , 1] , 
	[ 1382745600000 , 1] , 
	[ 1382832000000 , 0] , 
	[ 1382918400000 , 6] , 
	[ 1383004800000 , 2] , 
	[ 1383091200000 , 1] , 
	[ 1383177600000 , 1] , 
	[ 1383264000000 , 2] , 
	[ 1383350400000 , 0] , 
	[ 1383436800000 , 1] , 
	[ 1383523200000 , 0] , 
	[ 1383609600000 , 4] , 
	[ 1383696000000 , 3] , 
	[ 1383782400000 , 6] , 
	[ 1383868800000 , 3] , 
	[ 1383955200000 , 0] , 
	[ 1384041600000 , 1] , 
	[ 1384128000000 , 6] , 
	[ 1384214400000 , 2] , 
	[ 1384300800000 , 2] , 
	[ 1384387200000 , 1] , 
	[ 1384473600000 , 5] , 
	[ 1384560000000 , 0] , 
	[ 1384646400000 , 1] , 
	[ 1384732800000 , 4] , 
	[ 1384819200000 , 3] , 
	[ 1384905600000 , 6] , 
	[ 1384992000000 , 5] , 
	[ 1385078400000 , 8] , 
	[ 1385164800000 , 0] , 
	[ 1385251200000 , 0] , 
	[ 1385337600000 , 1] , 
	[ 1385424000000 , 4] , 
	[ 1385510400000 , 2] , 
	[ 1385596800000 , 0] , 
	[ 1385683200000 , 1] , 
	[ 1385769600000 , 1] , 
	[ 1385856000000 , 0] , 
	[ 1385942400000 , 9] , 
	[ 1386028800000 , 4] , 
	[ 1386115200000 , 8] , 
	[ 1386201600000 , 6] , 
	[ 1386288000000 , 4] , 
	[ 1386374400000 , 1] , 
	[ 1386460800000 , 0] , 
	[ 1386547200000 , 1] , 
	[ 1386633600000 , 3] , 
	[ 1386720000000 , 6] , 
	[ 1386806400000 , 5] , 
	[ 1386892800000 , 5] , 
	[ 1386979200000 , 0] , 
	[ 1387065600000 , 0] , 
	[ 1387152000000 , 3] , 
	[ 1387238400000 , 3] , 
	[ 1387324800000 , 1] , 
	[ 1387411200000 , 5] , 
	[ 1387497600000 , 1] , 
	[ 1387584000000 , 0] , 
	[ 1387670400000 , 1] , 
	[ 1387756800000 , 1] , 
	[ 1387843200000 , 0] , 
	[ 1387929600000 , 0] , 
	[ 1388016000000 , 0] , 
	[ 1388102400000 , 3] , 
	[ 1388188800000 , 0] , 
	[ 1388275200000 , 0] , 
	[ 1388361600000 , 0] , 
	[ 1388448000000 , 1]	
	]
  } ,
  {
    "key" : "PAT" ,
    "values" : [ 
	[ 1380585600000 , 0] , 
	[ 1380672000000 , 3] , 
	[ 1380758400000 , 4] , 
	[ 1380844800000 , 0] , 
	[ 1380931200000 , 0] , 
	[ 1381017600000 , 0] , 
	[ 1381104000000 , 5] , 
	[ 1381190400000 , 1] , 
	[ 1381276800000 , 1] , 
	[ 1381363200000 , 0] , 
	[ 1381449600000 , 0] , 
	[ 1381536000000 , 0] , 
	[ 1381622400000 , 0] , 
	[ 1381708800000 , 0] , 
	[ 1381795200000 , 3] , 
	[ 1381881600000 , 1] , 
	[ 1381968000000 , 1] , 
	[ 1382054400000 , 1] , 
	[ 1382140800000 , 0] , 
	[ 1382227200000 , 0] , 
	[ 1382313600000 , 0] , 
	[ 1382400000000 , 3] , 
	[ 1382486400000 , 1] , 
	[ 1382572800000 , 0] , 
	[ 1382659200000 , 1] , 
	[ 1382745600000 , 0] , 
	[ 1382832000000 , 0] , 
	[ 1382918400000 , 4] , 
	[ 1383004800000 , 1] , 
	[ 1383091200000 , 1] , 
	[ 1383177600000 , 1] , 
	[ 1383264000000 , 0] , 
	[ 1383350400000 , 0] , 
	[ 1383436800000 , 0] , 
	[ 1383523200000 , 1] , 
	[ 1383609600000 , 0] , 
	[ 1383696000000 , 0] , 
	[ 1383782400000 , 3] , 
	[ 1383868800000 , 0] , 
	[ 1383955200000 , 0] , 
	[ 1384041600000 , 0] , 
	[ 1384128000000 , 1] , 
	[ 1384214400000 , 2] , 
	[ 1384300800000 , 3] , 
	[ 1384387200000 , 1] , 
	[ 1384473600000 , 1] , 
	[ 1384560000000 , 0] , 
	[ 1384646400000 , 0] , 
	[ 1384732800000 , 2] , 
	[ 1384819200000 , 2] , 
	[ 1384905600000 , 1] , 
	[ 1384992000000 , 3] , 
	[ 1385078400000 , 1] , 
	[ 1385164800000 , 0] , 
	[ 1385251200000 , 0] , 
	[ 1385337600000 , 3] , 
	[ 1385424000000 , 0] , 
	[ 1385510400000 , 2] , 
	[ 1385596800000 , 0] , 
	[ 1385683200000 , 1] , 
	[ 1385769600000 , 0] , 
	[ 1385856000000 , 0] , 
	[ 1385942400000 , 4] , 
	[ 1386028800000 , 2] , 
	[ 1386115200000 , 1] , 
	[ 1386201600000 , 2] , 
	[ 1386288000000 , 1] , 
	[ 1386374400000 , 0] , 
	[ 1386460800000 , 0] , 
	[ 1386547200000 , 0] , 
	[ 1386633600000 , 1] , 
	[ 1386720000000 , 3] , 
	[ 1386806400000 , 1] , 
	[ 1386892800000 , 1] , 
	[ 1386979200000 , 0] , 
	[ 1387065600000 , 0] , 
	[ 1387152000000 , 2] , 
	[ 1387238400000 , 3] , 
	[ 1387324800000 , 0] , 
	[ 1387411200000 , 2] , 
	[ 1387497600000 , 1] , 
	[ 1387584000000 , 0] , 
	[ 1387670400000 , 0] , 
	[ 1387756800000 , 1] , 
	[ 1387843200000 , 1] , 
	[ 1387929600000 , 0] , 
	[ 1388016000000 , 0] , 
	[ 1388102400000 , 0] , 
	[ 1388188800000 , 1] , 
	[ 1388275200000 , 0] , 
	[ 1388361600000 , 1] , 
	[ 1388448000000 , 0]	
	]
  } ,
  {
    "key" : "WebM" ,
    "values" : [ 
	[ 1380585600000 , 0] , 
	[ 1380672000000 , 2] , 
	[ 1380758400000 , 1] , 
	[ 1380844800000 , 3] , 
	[ 1380931200000 , 2] , 
	[ 1381017600000 , 0] , 
	[ 1381104000000 , 5] , 
	[ 1381190400000 , 0] , 
	[ 1381276800000 , 3] , 
	[ 1381363200000 , 5] , 
	[ 1381449600000 , 0] , 
	[ 1381536000000 , 1] , 
	[ 1381622400000 , 0] , 
	[ 1381708800000 , 7] , 
	[ 1381795200000 , 0] , 
	[ 1381881600000 , 6] , 
	[ 1381968000000 , 2] , 
	[ 1382054400000 , 2] , 
	[ 1382140800000 , 1] , 
	[ 1382227200000 , 13] , 
	[ 1382313600000 , 1] , 
	[ 1382400000000 , 4] , 
	[ 1382486400000 , 4] , 
	[ 1382572800000 , 5] , 
	[ 1382659200000 , 3] , 
	[ 1382745600000 , 0] , 
	[ 1382832000000 , 0] , 
	[ 1382918400000 , 3] , 
	[ 1383004800000 , 6] , 
	[ 1383091200000 , 8] , 
	[ 1383177600000 , 2] , 
	[ 1383264000000 , 5] , 
	[ 1383350400000 , 0] , 
	[ 1383436800000 , 0] , 
	[ 1383523200000 , 2] , 
	[ 1383609600000 , 8] , 
	[ 1383696000000 , 5] , 
	[ 1383782400000 , 1] , 
	[ 1383868800000 , 2] , 
	[ 1383955200000 , 1] , 
	[ 1384041600000 , 0] , 
	[ 1384128000000 , 0] , 
	[ 1384214400000 , 5] , 
	[ 1384300800000 , 1] , 
	[ 1384387200000 , 2] , 
	[ 1384473600000 , 4] , 
	[ 1384560000000 , 1] , 
	[ 1384646400000 , 0] , 
	[ 1384732800000 , 1] , 
	[ 1384819200000 , 4] , 
	[ 1384905600000 , 0] , 
	[ 1384992000000 , 2] , 
	[ 1385078400000 , 2] , 
	[ 1385164800000 , 0] , 
	[ 1385251200000 , 0] , 
	[ 1385337600000 , 2] , 
	[ 1385424000000 , 1] , 
	[ 1385510400000 , 0] , 
	[ 1385596800000 , 0] , 
	[ 1385683200000 , 1] , 
	[ 1385769600000 , 0] , 
	[ 1385856000000 , 0] , 
	[ 1385942400000 , 1] , 
	[ 1386028800000 , 2] , 
	[ 1386115200000 , 1] , 
	[ 1386201600000 , 0] , 
	[ 1386288000000 , 1] , 
	[ 1386374400000 , 0] , 
	[ 1386460800000 , 1] , 
	[ 1386547200000 , 4] , 
	[ 1386633600000 , 2] , 
	[ 1386720000000 , 2] , 
	[ 1386806400000 , 1] , 
	[ 1386892800000 , 38] , 
	[ 1386979200000 , 2] , 
	[ 1387065600000 , 2] , 
	[ 1387152000000 , 20] , 
	[ 1387238400000 , 2] , 
	[ 1387324800000 , 3] , 
	[ 1387411200000 , 1] , 
	[ 1387497600000 , 2] , 
	[ 1387584000000 , 0] , 
	[ 1387670400000 , 0] , 
	[ 1387756800000 , 3] , 
	[ 1387843200000 , 1] , 
	[ 1387929600000 , 0] , 
	[ 1388016000000 , 7] , 
	[ 1388102400000 , 1] , 
	[ 1388188800000 , 0] , 
	[ 1388275200000 , 0] , 
	[ 1388361600000 , 3] , 
	[ 1388448000000 , 1]
	]
  }
];

/*
// for testing single data point
var histcatexplong = [
  {
    "key" : "Consumer Discretionary" ,
    "values" : [ [ 1138683600000 , 27.38478809681]]
  } ,
  {
    "key" : "Consumer Staples" ,
    "values" : [ [ 1138683600000 , 7.2800122043237]]
  } ,
  {
    "key" : "Energy" ,
    "values" : [ [ 1138683600000 , 1.544303464167]]
  } ,
  {
    "key" : "Financials" ,
    "values" : [ [ 1138683600000 , 13.356778764352]]
  } ,
  {
    "key" : "Health Care" ,
    "values" : [ [ 1138683600000 , 14.212410956029]]
  } ,
  {
    "key" : "Industrials" ,
    "values" : [ [ 1138683600000 , 7.1590087090398]]
  } ,
  {
    "key" : "Information Technology" ,
    "values" : [ [ 1138683600000 , 13.242301508051]]
  } ,
  {
    "key" : "Materials" ,
    "values" : [ [ 1138683600000 , 5.5806167415681]]
  } ,
  {
    "key" : "Telecommunication Services" ,
    "values" : [ [ 1138683600000 , 3.7056975170243]]
  } ,
  {
    "key" : "Utilities" ,
    "values" : [ [ 1138683600000 , 0]]
  }
];
*/

/*
.map(function(series) {
  series.values = series.values.map(function(d) {
    return { x: d[0], y: d[1] }
  });
  return series;
});
*/

var colors = d3.scale.category20();
keyColor = function(d, i) {return colors(d.key)};
var chart;
nv.addGraph(function() {
  chart = nv.models.stackedAreaChart()
                .width(1000).height(500)
                .useInteractiveGuideline(true)
                .x(function(d) { return d[0] })
                .y(function(d) { return d[1] })
                .color(keyColor)
                .transitionDuration(300);
                //.clipEdge(true);

// chart.stacked.scatter.clipVoronoi(false);

  chart.xAxis
      .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });

  chart.yAxis
      .tickFormat(d3.format(',f'));

  d3.select('#chart2')
    .datum(histcatexplong)
    .transition().duration(1000)
    .call(chart)
    // .transition().duration(0)
    .each('start', function() {
        setTimeout(function() {
            d3.selectAll('#chart2 *').each(function() {
              
              // while(this.__transition__)
              if(this.__transition__)
                this.__transition__.duration = 1;
            })
          }, 0)
      })

  nv.utils.windowResize(chart.update);

  // chart.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });

  return chart;
});

nv.addGraph(function() {
  var chart = nv.models.stackedAreaChart()
                .x(function(d) { return d[0] })
                .y(function(d) { return d[1] })
                .color(keyColor);
                //.clipEdge(true);

  chart.xAxis
      .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });

  chart.yAxis
      .tickFormat(d3.format(',f'));

  nv.utils.windowResize(chart.update);

  return chart;
});


}